<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<SimEntity extend="simkit.smdx.PathMoverManager" author="rmgoldbe" version="1.0" package="examples.movers.wfpsim" name="PBMM" xsi:noNamespaceSchemaLocation="http://diana.gl.nps.navy.mil/Simkit/simkit.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Comment>PatrolBoatMoverManager ( PBMM for short )</Comment>
    <Parameter name="patrolBoatMover" type="simkit.smdx.UniformLinearMover">
        <Comment/>
    </Parameter>
    <Parameter name="path" type="java.awt.geom.Point2D[]">
        <Comment/>
    </Parameter>
    <StateVariable type="int" name="wayPoint">
        <Comment/>
    </StateVariable>
    <StateVariable type="boolean" name="patrolling">
        <Comment/>
    </StateVariable>
    <StateVariable type="simkit.smdx.UniformLinearMover" name="patrolBoat">
        <Comment/>
    </StateVariable>
    <Event name="Run">
        <Comment/>
        <StateTransition state="wayPoint">
            <Assignment value="0"/>
        </StateTransition>
        <StateTransition state="patrolBoat">
            <Assignment value="patrolBoatMover"/>
        </StateTransition>
        <Coordinate x="46" y="55"/>
    </Event>
    <Event name="StartPatrolling">
        <Comment/>
        <StateTransition state="patrolling">
            <Assignment value="true"/>
        </StateTransition>
        <Schedule delay="0.0" event="NextWayPt" priority="0" condition="patrolling">
            <Comment/>
        </Schedule>
        <Coordinate x="48" y="175"/>
    </Event>
    <Event name="NextWayPt">
        <Comment/>
        <StateTransition state="patrolBoat">
            <Operation method="moveTo(path[wayPoint])"/>
        </StateTransition>
        <Schedule delay="0.0" event="StartMove" priority="0" condition="true">
            <Comment/>
            <EdgeParameter value="getPatrolBoat()"/>
        </Schedule>
        <Coordinate x="219" y="203"/>
    </Event>
    <Event name="StartMove">
        <Comment/>
        <Argument name="m" type="simkit.smdx.UniformLinearMover"/>
        <LocalVariable type="simkit.smdx.UniformLinearMover" value="m" name="tgt">
            <Comment/>
        </LocalVariable>
        <Schedule delay="patrolBoat.getMoveTime()" event="EndMove" priority="0" condition="true">
            <Comment/>
            <EdgeParameter value="tgt"/>
        </Schedule>
        <Coordinate x="419" y="114"/>
    </Event>
    <Event name="EndMove">
        <Comment/>
        <Argument name="tgt" type="simkit.smdx.UniformLinearMover"/>
        <StateTransition state="wayPoint">
            <Assignment value="wayPoint + ((wayPoint &gt;= (path.length-1))?1:-wayPoint)"/>
        </StateTransition>
        <Schedule event="NextWayPt"/>
        <Schedule delay="0.0" event="EndIntercept" priority="0" condition="(!patrolling) &amp;&amp; (tgt != null)">
            <Comment/>
            <EdgeParameter value="tgt"/>
        </Schedule>
        <Coordinate x="424" y="319"/>
    </Event>
    <Event name="Intercept">
        <Comment>Notes: the thesis shows a schedule from EndMove if another Intercept is immediately ready</Comment>
        <Argument name="intercept" type="java.awt.geom.Point2D"/>
        <Argument name="newTarget" type="simkit.smdx.UniformLinearMover"/>
        <StateTransition state="patrolBoat">
            <Operation method="moveTo(intercept)"/>
        </StateTransition>
        <StateTransition state="patrolling">
            <Assignment value="false"/>
        </StateTransition>
        <Cancel event="EndMove"/>
        <Schedule delay="patrolBoat.getMoveTime()" event="EndMove" priority="0" condition="true">
            <Comment/>
            <EdgeParameter value="newTarget"/>
        </Schedule>
        <Coordinate x="50" y="324"/>
    </Event>
    <Event name="EndIntercept">
        <Comment/>
        <Argument name="tgt" type="simkit.smdx.UniformLinearMover"/>
        <StateTransition state="patrolling">
            <Assignment value="true"/>
        </StateTransition>
        <Coordinate x="417" y="460"/>
    </Event>
    <Event name="Stop">
        <Comment/>
        <StateTransition state="patrolling">
            <Assignment value="false"/>
        </StateTransition>
        <StateTransition state="patrolBoat">
            <Operation method="stop()"/>
        </StateTransition>
        <Cancel event="EndMove"/>
        <Coordinate x="58" y="462"/>
    </Event>
</SimEntity>

