<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<SimkitModule name="ServerWithReneges" version="0.1" xsi:noNamespaceSchemaLocation="http://diana.gl.nps.navy.mil/Simkit/simkit.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Parameter type="int" name="numberServers"/>
    <Parameter type="simkit.random.RandomVariate" name="serviceTime"/>
    <Parameter type="simkit.random.RandomVariate" name="renegeTime"/>
    <StateVariable name="numberAvailableServers" type="int"/>
    <StateVariable name="queue" type="java.util.LinkedList"/>
    <StateVariable name="numberServed" type="int"/>
    <StateVariable name="numberReneges" type="int">
        <Comment>this state variable stores the number of reneges</Comment>
        <Comment>as a Java int.</Comment>
    </StateVariable>
    <Event name="Run">
        <StateTransition state="numberAvailableServers">
            <Assignment value="getNumberServers()"/>
        </StateTransition>
        <StateTransition state="queue">
            <Operation method="clear()"/>
        </StateTransition>
        <StateTransition state="numberServed">
            <Assignment value="0"/>
        </StateTransition>
        <StateTransition state="numberReneges">
            <Assignment value="0"/>
        </StateTransition>
        <Coordinate y="0" x="10"/>
    </Event>
    <Event name="Arrival">
        <Argument name="customer" type="java.lang.Ingeger"/>
        <StateTransition state="queue">
            <Operation method="add(customer)"/>
        </StateTransition>
        <Schedule delay="renegeTime.generate()" event="Renege">
            <EdgeParameter value="customer"/>
        </Schedule>
        <Schedule condition="numberAvailableServers &gt; 0" delay="0.0" event="StartService"/>
        <Coordinate y="70" x="10"/>
    </Event>
    <Event name="StartService">
        <LocalVariable name="customer" type="java.lang.Integer" value="(Integer)queue.first()">
            <Comment/>
        </LocalVariable>
        <StateTransition state="queue">
            <Operation method="removeFirst()"/>
        </StateTransition>
        <StateTransition state="numberAvailableServers">
            <Assignment value="numberAvailableServers - 1"/>
        </StateTransition>
        <Cancel event="Renege">
            <EdgeParameter value="customer"/>
        </Cancel>
        <Schedule delay="serviceTime.generate()" event="EndService">
            <EdgeParameter value="customer"/>
        </Schedule>
        <Coordinate y="70" x="160"/>
    </Event>
    <Event name="EndService">
        <Argument name="customer1" type="java.lang.Integer"/>
        <StateTransition state="numberAvailableServers">
            <Assignment value="numberAvailableServers+1"/>
        </StateTransition>
        <StateTransition state="numberServed">
            <Assignment value="numberServed+1"/>
        </StateTransition>
        <Schedule condition="numberInQueue &gt; 0" priority="1.0" event="StartService"/>
        <Coordinate y="70" x="300"/>
    </Event>
    <Event name="Renege">
        <Argument name="customer2" type="java.lang.Integer"/>
        <StateTransition state="queue">
            <Operation method="remove(customer2)"/>
        </StateTransition>
        <StateTransition state="numberReneges">
            <Assignment value="numberReneges+1"/>
        </StateTransition>
        <Coordinate y="190" x="70"/>
    </Event>
</SimkitModule>

