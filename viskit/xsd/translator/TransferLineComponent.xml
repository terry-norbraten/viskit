<?xml version="1.0" encoding="UTF-8"?>

<!--
    Document   : TransferLineComponent.xml
    Created on : April 30, 2004, 12:55 PM
    Author     : Rick Goldberg
    Description:
        Advanced Simkit application.
-->

<!--<!DOCTYPE SimkitModule PUBLIC '-//NPS Simkit//DTD Web Application//EN' 'http://bloak.com/home/rmgold/CVS/Simkit/simkit/xsd/translator/simkit.dtd'>
-->
<SimkitModule
    name="TransferLineComponent"
    version="0.0.1" >

    <Parameter name="totalNumberServers" type="int[]" />
    <Parameter name="serviceTime" type="simkit.random.RandomVariate[]" />
    
    <StateVariable name="numberAvailableServers" type="int[]" />
    <StateVariable name="numberInQueue" type="int[]" />
    
    <Event name="Run" >
	<LocalVariable name="j" type="int" />
    
        <StateTransition state="numberAvailableServers" index="j" >
            <Assignment value="totalNumberServers[j]" />
        </StateTransition>
    
        <StateTransition state="numberInQueue" index="j">
            <Assignment value="0" />
        </StateTransition>
        
        <Schedule event="InitializeWorkcenter" delay="0.0" > 
	    <EdgeParameter value="0" />
	</Schedule>

    </Event>

    <Event name="InitializeWorkcenter" >
        
        <Argument name="i" type="int" />
        
        <StateTransition state="numberInQueue" index="i" >
            <Assignment value="0" />
        </StateTransition>
        
        <StateTransition state="numberAvailableServers" index="i" >
            <Assignment value="totalNumberServers[i]" />
        </StateTransition>

        <Schedule event="InitializeWorkcenter" condition="i &lt; totalNumberServers.length - 1" >
            <EdgeParameter value="i+1" />
        </Schedule>
        
    </Event>

    <Event name="Arrival" >
	<Argument name="i" type="int" />
	
	<StateTransition state="numberInQueue" index="i" >
	    <Assignment value="numberInQueue[i] + 1" />
	</StateTransition>

	<Schedule event="StartService" condition="getNumberAvailableServers(i) > 0" >
	    <EdgeParameter value="i" />
	</Schedule>

    </Event>
    
    <Event name="StartService" >
        
        <Argument name="i" type="int" />
        
        <StateTransition state="numberInQueue" index="i" >
            <Assignment value="numberInQueue[i] + 1" />
        </StateTransition>
        
        
        <StateTransition state="numberAvailableServers" index="i" >
            <Assignment value="numberAvailableServers[i] - 1" />
        </StateTransition>
        
        
        <Schedule event="EndService" delay="serviceTime[i].generate()" >
            <EdgeParameter value="i" />
        </Schedule>
        
    </Event>
    
    <Event name="EndService" >
    
        <Argument name="i" type="int" />
        
        <StateTransition state="numberAvailableServers" index="i" >
            <Assignment value="numberAvailableServers[i]+1" />
        </StateTransition>
        
        <Schedule event="StartService" condition="getNumberInQueue(i) > 0" />
        <Schedule event="Arrival" condition="i &lt; totalNumberServers.length - 1" />
        
    </Event>
    
</SimkitModule>
