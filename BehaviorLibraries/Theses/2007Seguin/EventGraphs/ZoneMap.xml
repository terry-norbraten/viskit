<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<SimEntity author="John Seguin" extend="SimEntityBase" name="ZoneMap" package="seadiver" version="$Id$" xsi:noNamespaceSchemaLocation="http://diana.gl.nps.navy.mil/Simkit/simkit.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Parameter name="origin" type="diskit.X3DCoordinate">
        <Comment>Origin of area.</Comment>
    </Parameter>
    <Parameter name="length" type="double">
        <Comment>Length of total area.</Comment>
    </Parameter>
    <Parameter name="width" type="double">
        <Comment>Width of total area.</Comment>
    </Parameter>
    <Parameter name="height" type="double">
        <Comment>Height of total area.</Comment>
    </Parameter>
    <StateVariable name="moverID" type="int">
        <Comment>First mover number for iteration.</Comment>
    </StateVariable>
    <StateVariable name="numberOfTargets" type="int">
        <Comment>Total number of targets.</Comment>
    </StateVariable>
    <StateVariable name="centerPoint" type="diskit.X3DCoordinate">
        <Comment>Center of zone in X3D space</Comment>
    </StateVariable>
    <StateVariable name="zones" type="SymmetricZoneMap">
        <Comment>Individual zones for each mover.</Comment>
    </StateVariable>
    <StateVariable name="axisAngle" type="diskit.Vec4d">
        <Comment>Rotation of area.</Comment>
    </StateVariable>
    <StateVariable name="area" type="diskit.ZoneGeometry">
        <Comment>ZoneGeometry created to encompass area.</Comment>
    </StateVariable>
    <StateVariable name="numberOfWaypoints" type="int">
        <Comment>Number of zones to create for Targets.</Comment>
    </StateVariable>
    <StateVariable name="zoneList" type="java.util.LinkedList">
        <Comment>List of zones for waypoint generation for Targets.</Comment>
    </StateVariable>
    <Event name="Run">
        <Comment/>
        <StateTransition state="centerPoint">
            <Assignment value="new diskit.X3DCoordinate(length/2,width/2,height/2)"/>
        </StateTransition>
        <StateTransition state="axisAngle">
            <Operation method="set(0,0,-1,0)"/>
        </StateTransition>
        <StateTransition state="numberOfWaypoints">
            <Assignment value="0"/>
        </StateTransition>
        <StateTransition state="numberOfTargets">
            <Assignment value="0"/>
        </StateTransition>
        <StateTransition state="zoneList">
            <Operation method="clear()"/>
        </StateTransition>
        <Schedule condition="true" delay="0.0" event="CreateArea" priority="1.7976931348623157E308">
            <Comment/>
        </Schedule>
        <Code>//System.out.println("Run event for Map:  ");</Code>
        <Coordinate x="60" y="70"/>
    </Event>
    <Event name="CreateMap">
        <Comment/>
        <Argument name="numDivers" type="int">
            <Comment>Total number of seadivers to create zones for.</Comment>
        </Argument>
        <Argument name="firstMoverID" type="int">
            <Comment>ID start range of movers</Comment>
        </Argument>
        <StateTransition state="zones">
            <Assignment value="new SymmetricZoneMap(numDivers, firstMoverID, getArea())"/>
        </StateTransition>
        <Schedule condition="true" delay="0.0" event="RegisterMap" priority="1.7976931348623157E308">
            <Comment/>
            <EdgeParameter value="zones"/>
            <EdgeParameter value="getNumberOfTargets()"/>
        </Schedule>
        <Code>// System.out.println("totalArea:" + area.getLength());</Code>
        <Coordinate x="60" y="150"/>
    </Event>
    <Event name="RegisterMap">
        <Comment/>
        <Argument name="moverZones" type="SymmetricZoneMap"/>
        <Argument name="numTgts" type="int"/>
        <Code/>
        <Coordinate x="180" y="150"/>
    </Event>
    <Event name="CreateArea">
        <Comment>Create a ZoneGeometry object of area.</Comment>
        <StateTransition state="area">
            <Assignment value="new diskit.ZoneGeometry( 1, getCenterPoint(), getLength(), getWidth(), getHeight(), getAxisAngle())"/>
        </StateTransition>
        <Code>//System.out.println("Length:" + getLength());
//System.out.println("Width:" + getWidth());
// System.out.println("totalArea:" + getLength());
// System.out.println("totalArea:" + getLength());</Code>
        <Coordinate x="180" y="70"/>
    </Event>
    <Event name="DetermineTargetZones">
        <Comment/>
        <Argument name="numZones" type="int"/>
        <Argument name="numOfTargets" type="int"/>
        <StateTransition state="numberOfWaypoints">
            <Assignment value="numZones"/>
        </StateTransition>
        <StateTransition state="numberOfTargets">
            <Assignment value="numOfTargets"/>
        </StateTransition>
        <Schedule condition="true" delay="0.0" event="CreateZones" priority="1.7976931348623157E308">
            <Comment/>
            <EdgeParameter value="0"/>
        </Schedule>
        <Code/>
        <Coordinate x="60" y="250"/>
    </Event>
    <Event name="RegisterZones">
        <Comment/>
        <Argument name="wpZones" type="java.util.LinkedList"/>
        <Code/>
        <Coordinate x="160" y="340"/>
    </Event>
    <Event name="CreateZones">
        <Comment>Zones for waypoint generation for Targets.</Comment>
        <Argument name="zoneIterator" type="int"/>
        <StateTransition state="zoneList">
            <Operation method="add(zone)"/>
        </StateTransition>
        <Schedule condition="zoneIterator &lt; getNumberOfWaypoints()" delay="0.0" event="CreateZones" priority="1.7976931348623157E308">
            <Comment/>
            <EdgeParameter value="zoneIterator + 1"/>
        </Schedule>
        <Schedule condition="zoneList.size() == getNumberOfWaypoints()" delay="0.0" event="RegisterZones" priority="1.7976931348623157E308">
            <Comment/>
            <EdgeParameter value="getZoneList()"/>
        </Schedule>
        <Code>double wdth = getWidth()/getNumberOfWaypoints();
double wdthOffset = wdth/2 + wdth*zoneIterator;

diskit.X3DCoordinate centerPt = new diskit.X3DCoordinate(getLength()/2, 0.0, wdthOffset);
//System.out.println("centerPt is:  " + centerPt.toString());

diskit.ZoneGeometry zone;
zone = new diskit.ZoneGeometry(zoneIterator, centerPt, getLength(), wdth, 0.0, getAxisAngle());</Code>
        <Coordinate x="60" y="340"/>
    </Event>
    <Code/>
</SimEntity>

