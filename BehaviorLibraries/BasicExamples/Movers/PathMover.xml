<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<SimEntity author="pjsulliv" extend="diskit.DISMover3D" name="PathMover" package="Movers" version="1.0" xsi:noNamespaceSchemaLocation="http://diana.nps.edu/Simkit/simkit.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Parameter name="start" type="diskit.Vec3d">
        <Comment>The starting position for this entity</Comment>
    </Parameter>
    <Parameter name="maximumSpeed" type="double">
        <Comment>The maximum speed for this entity</Comment>
    </Parameter>
    <Parameter name="moverID" type="int">
        <Comment>The unique DIS entity ID number for this entity</Comment>
    </Parameter>
    <Parameter name="waypoints" type="diskit.Vec3d[]">
        <Comment>The waypoints that this entity will use to navigate</Comment>
    </Parameter>
    <StateVariable name="pathMoverManager" type="diskit.PathMoverManager">
        <Comment>Provides the next waypoint based on the array of waypoints provided (in the order they were provided)</Comment>
    </StateVariable>
    <StateVariable name="tacticalMode" type="diskit.TacticalMode">
        <Comment>The mode that this mover is currently in</Comment>
    </StateVariable>
    <Event name="Run">
        <Comment>Required event that is called at the begining of each simulation run</Comment>
        <StateTransition state="pathMoverManager">
            <Assignment value="null"/>
        </StateTransition>
        <Schedule condition="waypoints.length &gt; 0" delay="0.0" event="ProcessWaypoints" priority="DEFAULT">
            <Comment>Only proceed if this mover has waypoints to process, otherwise do nothing</Comment>
        </Schedule>
        <Code/>
        <Coordinate x="20" y="150"/>
    </Event>
    <Event name="Init">
        <Comment>Called from super class to initialize movers</Comment>
        <Argument name="entity" type="simkit.SimEntity">
            <Comment>The entity being called by it's super class</Comment>
        </Argument>
        <Schedule condition="entity == this" delay="0.0" event="RegisterTarget" priority="DEFAULT">
            <Comment>Only register this mover if the super class called this entity</Comment>
            <EdgeParameter value="this"/>
        </Schedule>
        <Code/>
        <Coordinate x="20" y="30"/>
    </Event>
    <Event name="RegisterTarget">
        <Comment>Registers this entity as a mover in the scenario</Comment>
        <Argument name="mover" type="diskit.Mover3D">
            <Comment>This mover</Comment>
        </Argument>
        <Code/>
        <Coordinate x="130" y="30"/>
    </Event>
    <Event name="ProcessWaypoints">
        <Comment>This event creates a mover manager object with the waypoints that were included as a parameter to this graph. If no waypoints are specificed the movement process will not be scheduled.</Comment>
        <StateTransition state="pathMoverManager">
            <Assignment value="new diskit.PathMoverManager(this, waypoints, true)"/>
        </StateTransition>
        <Schedule event="StartMoving"/>
        <Code/>
        <Coordinate x="120" y="150"/>
    </Event>
    <Event name="StartMoving">
        <Comment>Begins the movement of this entity. Continuous movement based on waypoints from the provided zones will continue until the mover manager is changed</Comment>
        <StateTransition state="tacticalMode">
            <Assignment value="diskit.TacticalMode.TRANSITING"/>
        </StateTransition>
        <Code>/*REQUIRED CODE BLOCK FOR MOVER TO START MOVING
Without these method calls, IN THIS ORDER, the mover will do nothing. These method calls set the mover in motion and are invoking methods in the super class*/
setStartPosition(getLocation());
setCruiseSpeed(maximumSpeed/2);
start();</Code>
        <Coordinate x="220" y="150"/>
    </Event>
</SimEntity>

