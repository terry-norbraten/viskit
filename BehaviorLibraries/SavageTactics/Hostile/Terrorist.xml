<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<SimEntity author="pjsulliv" extend="diskit.DISMover3D" name="Terrorist" package="diskit" version="1.0" xsi:noNamespaceSchemaLocation="http://diana.gl.nps.navy.mil/Simkit/simkit.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Comment>Terrorist that starts from a point randomly within ZoneGeometry objects.  Terrorist will proceed towards the harbor, scans the area for potential targets and attacks the targets in order of proximity and order in which detected.

TODO: Add booleans to the constructor for attack Friendly, attack HVU</Comment>
    <Parameter name="startPosition" type="diskit.Vec3d">
        <Comment>Start position for this entity</Comment>
    </Parameter>
    <Parameter name="maxSpeed" type="double">
        <Comment/>
    </Parameter>
    <Parameter name="moverID" type="int">
        <Comment>Unique DIS entity ID number</Comment>
    </Parameter>
    <Parameter name="blastRadius" type="double">
        <Comment>proximity to a target required to effectively destroy it</Comment>
    </Parameter>
    <Parameter name="startPositions" type="diskit.ZoneGeometry[]">
        <Comment/>
    </Parameter>
    <StateVariable name="avoidanceRange" type="double">
        <Comment/>
    </StateVariable>
    <StateVariable name="targetAquire" type="diskit.Sensor">
        <Comment>Sensor object that processes all targets in the state space before attacking</Comment>
    </StateVariable>
    <StateVariable name="interceptMoverManager" type="diskit.InterceptMoverManager">
        <Comment/>
    </StateVariable>
    <StateVariable name="attackCreator" type="diskit.WaypointCreator">
        <Comment/>
    </StateVariable>
    <StateVariable name="targetQueue" type="java.util.LinkedList">
        <Comment/>
    </StateVariable>
    <StateVariable name="activeMoverManager" type="diskit.MoverManager">
        <Comment/>
    </StateVariable>
    <StateVariable name="collisionAvoidance" type="diskit.Sensor">
        <Comment>Sensor that implements collision avoidance</Comment>
    </StateVariable>
    <StateVariable name="lethalRange" type="diskit.Sensor">
        <Comment>Range at which this terrorist can be lethal (assumes suicide bombing as attack)</Comment>
    </StateVariable>
    <StateVariable name="initialMoverManager" type="diskit.PathMoverManager">
        <Comment/>
    </StateVariable>
    <StateVariable name="successfulStartPosition" type="diskit.Vec3d">
        <Comment>TODO: add property stat</Comment>
    </StateVariable>
    <StateVariable name="unsuccessfulStartPosit" type="diskit.Vec3d">
        <Comment>TODO: add property stat</Comment>
    </StateVariable>
    <StateVariable name="successfullAttack" type="int">
        <Comment>TODO: add as property stat</Comment>
    </StateVariable>
    <StateVariable name="unsuccessfulAttack" type="int">
        <Comment>TODO: add as property stat</Comment>
    </StateVariable>
    <StateVariable name="lengthOfAttack" type="double">
        <Comment>TODO: add as property stat</Comment>
    </StateVariable>
    <StateVariable name="obstacleQueue" type="diskit.ObstacleQueue">
        <Comment/>
    </StateVariable>
    <StateVariable name="tacticalMode" type="diskit.TacticalMode">
        <Comment/>
    </StateVariable>
    <StateVariable name="geometry" type="diskit.ZoneGeometry[0]">
        <Comment/>
    </StateVariable>
    <Event name="Run">
        <Comment/>
        <StateTransition state="avoidanceRange">
            <Assignment value="30"/>
        </StateTransition>
        <StateTransition state="interceptMoverManager">
            <Assignment value="null"/>
        </StateTransition>
        <StateTransition state="activeMoverManager">
            <Assignment value="null"/>
        </StateTransition>
        <StateTransition state="targetQueue">
            <Operation method="clear()"/>
        </StateTransition>
        <StateTransition state="tacticalMode">
            <Assignment value="diskit.TacticalMode.TRANSITING"/>
        </StateTransition>
        <Schedule condition="true" delay="0.0" event="ChooseStartPosition" priority="0">
            <Comment/>
            <EdgeParameter value="startPositions"/>
        </Schedule>
        <Code/>
        <Coordinate x="30" y="30"/>
    </Event>
    <Event name="Init">
        <Comment/>
        <Argument name="entity" type="diskit.Mover3D"/>
        <StateTransition state="targetAquire">
            <Assignment value="new diskit.SphereCutterSensor(this, 2000)"/>
        </StateTransition>
        <Schedule condition="true" delay="0.0" event="RegisterTarget" priority="0">
            <Comment/>
            <EdgeParameter value="this"/>
        </Schedule>
        <Schedule condition="entity == this" delay="0.0" event="RegisterSensor" priority="0">
            <Comment/>
            <EdgeParameter value="targetAquire"/>
        </Schedule>
        <Code/>
        <Coordinate x="120" y="30"/>
    </Event>
    <Event name="RegisterTarget">
        <Comment/>
        <Argument name="target" type="diskit.Mover3D"/>
        <Code/>
        <Coordinate x="220" y="30"/>
    </Event>
    <Event name="ChooseStartPosition">
        <Comment/>
        <Argument name="activeZones" type="ZoneGeometry[]"/>
        <LocalVariable name="count" type="int" value="0">
            <Comment/>
        </LocalVariable>
        <LocalVariable name="idx" type="int" value="0">
            <Comment/>
        </LocalVariable>
        <LocalVariable name="startPositions" type="ZoneGeometry[]" value="null">
            <Comment/>
        </LocalVariable>
        <StateTransition state="attackCreator">
            <Assignment value="new diskit.WaypointCreator(startPositions)"/>
        </StateTransition>
        <Schedule condition="true" delay="0.0" event="BeginAttack" priority="0">
            <Comment/>
            <EdgeParameter value="attackCreator"/>
        </Schedule>
        <Code>for(int i = 0; i&lt;activeZones.length; i++){            if(activeZones[i].getID() == moverID){                  count++;               }   }   startPositions = new ZoneGeometry[count];   for(int i = 0; i &lt; activeZones.length; i++){        if(activeZones[i].getID() == moverID){          startPositions[idx] = activeZones[i];          idx++;           }   }</Code>
        <Coordinate x="30" y="200"/>
    </Event>
    <Event name="ChooseTarget">
        <Comment/>
        <Code/>
        <Coordinate x="220" y="220"/>
    </Event>
    <Event name="Detection">
        <Comment/>
        <Argument name="sensor" type="diskit.Sensor"/>
        <Argument name="contact" type="diskit.Mover3D"/>
        <Schedule condition="contact.getMoverID() &gt; 399 &amp; contact.getMoverID() &lt; 500" delay="0.0" event="Attack" priority="0">
            <Comment/>
            <EdgeParameter value="contact"/>
            <EdgeParameter value="sensor"/>
        </Schedule>
        <Code>System.out.println("Terrorist Detected Target # " + contact.getMoverID());</Code>
        <Coordinate x="320" y="310"/>
    </Event>
    <Event name="BeginAttack">
        <Comment>TODO: Move Harbor Center to the constructor for this event graph</Comment>
        <Argument name="attackStart" type="diskit.WaypointCreator"/>
        <LocalVariable name="harborLocation" type="diskit.Vec3d[]" value="new diskit.Vec3d[1]">
            <Comment/>
        </LocalVariable>
        <LocalVariable name="harborCenter" type="diskit.Vec3d" value="new diskit.Vec3d(-1235.309, -887.534, 0.0)">
            <Comment/>
        </LocalVariable>
        <Schedule event="Start"/>
        <Code>setStartPosition(attackStart.createWaypoint()); harborLocation[0] = harborCenter; initialMoverManager = new diskit.PathMoverManager(this, harborLocation, true); </Code>
        <Coordinate x="30" y="320"/>
    </Event>
    <Event name="Start">
        <Comment/>
        <LocalVariable name="movement" type="boolean" value="true">
            <Comment/>
        </LocalVariable>
        <LocalVariable name="harborCenter" type="diskit.Vec3d" value="new diskit.Vec3d(-1147.185, -975.658, 0.0)">
            <Comment/>
        </LocalVariable>
        <Code>setCruisingSpeed(getMaxSpeed()/2); </Code>
        <Coordinate x="30" y="430"/>
    </Event>
    <Event name="EndMove">
        <Comment/>
        <Schedule event="BeginAttack"/>
        <Code/>
        <Coordinate x="230" y="430"/>
    </Event>
    <Event name="RegisterSensor">
        <Comment/>
        <Argument name="newPercept" type="diskit.Sensor"/>
        <LocalVariable name="sensor" type="diskit.Sensor" value="newPercept">
            <Comment/>
        </LocalVariable>
        <Code>sensor.addSimEventListener(this);</Code>
        <Coordinate x="220" y="90"/>
    </Event>
    <Event name="Attack">
        <Comment/>
        <Argument name="target" type="diskit.Mover3D"/>
        <Argument name="sensor" type="diskit.Sensor"/>
        <LocalVariable name="amm" type="diskit.MoverManager" value="getActiveMoverManager()">
            <Comment/>
        </LocalVariable>
        <StateTransition state="interceptMoverManager">
            <Operation method="interceptToOffset(target,2.0*blastRadius)"/>
        </StateTransition>
        <Schedule condition="this.getLocation() == interceptMoverManager.getInterceptPoint() " delay="0.0" event="ChooseStartPosition" priority="0">
            <Comment/>
            <EdgeParameter value="startPositions"/>
        </Schedule>
        <Code>this.setStartPosition(getLocation()); this.setCruisingSpeed(getMaxSpeed());interceptMoverManager = new diskit.InterceptMoverManager(this);System.out.println("I am attacking "  + target.getMoverID() );</Code>
        <Coordinate x="220" y="310"/>
    </Event>
</SimEntity>

