<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<SimEntity author="pjsulliv" extend="diskit.FriendlyForce" name="MilitaryHelicopter" package="diskit" version="1.0" xsi:noNamespaceSchemaLocation="http://diana.gl.nps.navy.mil/Simkit/simkit.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Comment>Unmanned Aerial Vehicle.  This vehicle has the ability to provide sensory data and detect other entities but does not avoid other entities.</Comment>
    <Parameter name="moverID" type="int">
        <Comment>ESPDU unique id Number [0-999]</Comment>
    </Parameter>
    <Parameter name="startPosition" type="diskit.Vec3d">
        <Comment>Must be something other than the first waypoint</Comment>
    </Parameter>
    <Parameter name="maximumSpeed" type="double">
        <Comment>Maximum speed for this entity</Comment>
    </Parameter>
    <Parameter name="name" type="java.lang.String">
        <Comment>Should match name in assembly</Comment>
    </Parameter>
    <Parameter name="level" type="java.lang.String">
        <Comment>The classifcation level of this entity (e.g. UNCLASSIFIED)</Comment>
    </Parameter>
    <Parameter name="rationale" type="java.lang.String">
        <Comment>The specific element which contains the information classifying this document</Comment>
    </Parameter>
    <Parameter name="reference" type="java.lang.String">
        <Comment>The published source of classified information, if any</Comment>
    </Parameter>
    <Parameter name="length" type="double">
        <Comment>The maximum length of this craft in meters</Comment>
    </Parameter>
    <Parameter name="width" type="double">
        <Comment>The maximum beam of this craft in meters</Comment>
    </Parameter>
    <Parameter name="height" type="double">
        <Comment>The maximum height of this craft in meters</Comment>
    </Parameter>
    <Parameter name="aerodynamicCenter" type="double[]">
        <Comment>Center of Gravity of the object as an (x, y, z) distance in meters from the physical center of the object, which is located at (0, 0, 0)</Comment>
    </Parameter>
    <Parameter name="maximumAcceleration" type="double">
        <Comment>The maximum achievable acceleration</Comment>
    </Parameter>
    <Parameter name="maximumDeceleration" type="double">
        <Comment>The maximum achievable deceleration</Comment>
    </Parameter>
    <Parameter name="maximumAltitude" type="double">
        <Comment>The absolute ceiling for this aircraft in feet or meters</Comment>
    </Parameter>
    <Parameter name="cruiseAltitude" type="double">
        <Comment>The cruise ceiling for this aircraft in feet or meters</Comment>
    </Parameter>
    <Parameter name="maximumTurnRate" type="double">
        <Comment>The maximum turn rate in degrees per second</Comment>
    </Parameter>
    <Parameter name="minimumTurnRadius" type="double">
        <Comment>The minimum turning radius for this vehicle in feet or meters</Comment>
    </Parameter>
    <Parameter name="maximumSurfaceDetectionRange" type="double">
        <Comment>The maximum detection range of the longest range surface detection sensor</Comment>
    </Parameter>
    <Parameter name="maximumAirDetectionRange" type="double">
        <Comment>The maximum detection range of the longest range air detection sensor</Comment>
    </Parameter>
    <Parameter name="forceID" type="int">
        <Comment>The DIS Enumeration for the force id for this entity [0 = Other, 1 = Friend, 2 = Opposing, 3 = Neutral]</Comment>
    </Parameter>
    <Parameter name="entityDomain" type="int">
        <Comment>The DIS Enumeration for the domain for this entity [0 = Other, 1 = Land, 2 = Air, 3 = Surface, 4 = SubSurface]</Comment>
    </Parameter>
    <Parameter name="entityKind" type="int">
        <Comment>The DIS Enumeration for the overall type for this entity [1 = Platform, 3 = Life Form, 7 = Radio]</Comment>
    </Parameter>
    <Parameter name="entityCountry" type="int">
        <Comment>The DIS Enumeration for the country for this entity [225 = United States]</Comment>
    </Parameter>
    <Parameter name="zones" type="diskit.ProbabilityZoneGeometry[]">
        <Comment>The patrol zones for this entity</Comment>
    </Parameter>
    <StateVariable name="visualPerception" type="diskit.Sensor">
        <Comment>Visual sense of RHIB crew</Comment>
    </StateVariable>
    <StateVariable name="visualRange" type="double">
        <Comment>Visual Range for the crew</Comment>
    </StateVariable>
    <StateVariable name="avoidanceRange" type="double">
        <Comment>Proximity tolerance for this contact. Will maneuver to avoid objects that will breach this range</Comment>
    </StateVariable>
    <StateVariable name="tacticalMode" type="diskit.TacticalMode">
        <Comment>Tactical State that the RHIB is in (e.g. Patrolling, Intercepting)</Comment>
    </StateVariable>
    <StateVariable name="patrolManager" type="diskit.ZoneMoverManager">
        <Comment>Mover manager that manages entity movement based on diskit.ProbabilityZoneGeometry patrol zones</Comment>
    </StateVariable>
    <StateVariable name="waypointGenerator" type="diskit.WaypointCreator">
        <Comment>Generates waypoints based on the diskit.ProbabilityZoneGeometry for this entity</Comment>
    </StateVariable>
    <StateVariable name="obstacleQueue" type="diskit.ObstacleQueue">
        <Comment>Stores and sorts obstacles based on proximity</Comment>
    </StateVariable>
    <StateVariable name="targetQueue" type="diskit.TargetQueue">
        <Comment>Stores and sorts targets based on proximity</Comment>
    </StateVariable>
    <StateVariable name="successfulIntercepts" type="int">
        <Comment>DATA: Total number of successful intercepts</Comment>
    </StateVariable>
    <StateVariable name="unsuccessfulIntercepts" type="int">
        <Comment>DATA: Total number of successful intercepts</Comment>
    </StateVariable>
    <StateVariable name="speed" type="double">
        <Comment>DATA: Average Speed of this entity</Comment>
    </StateVariable>
    <StateVariable name="contactIDs" type="int">
        <Comment>DATA: Total number of contacts ID'd</Comment>
    </StateVariable>
    <StateVariable name="canIntercept" type="boolean">
        <Comment>Whether or not entity can catch up to contact</Comment>
    </StateVariable>
    <StateVariable name="missedIDs" type="int">
        <Comment>DATA: Total number of missed IDs due to distance</Comment>
    </StateVariable>
    <StateVariable name="distanceFromMissedAttacker" type="double">
        <Comment>DATA: Distance from attacker at time of successful attack</Comment>
    </StateVariable>
    <StateVariable name="destination" type="diskit.Vec3d">
        <Comment>This entities current destination</Comment>
    </StateVariable>
    <Event name="Run">
        <Comment>Initializes all state variables for each simulation run.</Comment>
        <StateTransition state="visualRange">
            <Assignment value="600"/>
        </StateTransition>
        <StateTransition state="avoidanceRange">
            <Assignment value="30"/>
        </StateTransition>
        <StateTransition state="successfulIntercepts">
            <Assignment value="0"/>
        </StateTransition>
        <StateTransition state="unsuccessfulIntercepts">
            <Assignment value="0"/>
        </StateTransition>
        <StateTransition state="speed">
            <Assignment value="0.0"/>
        </StateTransition>
        <StateTransition state="contactIDs">
            <Assignment value="0"/>
        </StateTransition>
        <StateTransition state="canIntercept">
            <Assignment value="false"/>
        </StateTransition>
        <StateTransition state="missedIDs">
            <Assignment value="0"/>
        </StateTransition>
        <StateTransition state="distanceFromMissedAttacker">
            <Assignment value="0"/>
        </StateTransition>
        <Schedule event="ScaleSpeedToKnots"/>
        <Schedule condition="zones.length != 0" delay="0.0" event="ReviewPatrol" priority="0">
            <Comment/>
            <EdgeParameter value="zones"/>
        </Schedule>
        <Code/>
        <Coordinate x="30" y="240"/>
    </Event>
    <Event name="Init">
        <Comment>Used by diskit.ScenarioManager to register all entities</Comment>
        <Argument name="entity" type="simkit.SimEntity">
            <Comment>Entity being initialized</Comment>
        </Argument>
        <StateTransition state="visualPerception">
            <Assignment value="new diskit.SphereCutterSensor(this, visualRange)"/>
        </StateTransition>
        <Schedule condition="entity == this" delay="0.0" event="RegisterTarget" priority="0">
            <Comment/>
            <EdgeParameter value="this"/>
        </Schedule>
        <Schedule condition="true" delay="0.0" event="RegisterSensor" priority="0">
            <Comment/>
            <EdgeParameter value="visualPerception"/>
        </Schedule>
        <Code/>
        <Coordinate x="240" y="20"/>
    </Event>
    <Event name="RegisterTarget">
        <Comment>Registers this mover with the simulation</Comment>
        <Argument name="m" type="diskit.Mover3D">
            <Comment>This mover being registered</Comment>
        </Argument>
        <Code/>
        <Coordinate x="320" y="110"/>
    </Event>
    <Event name="RegisterSensor">
        <Comment>Registers this entity's sensor with the simulation. Also registers a SimEventListener between this mover and its sensor</Comment>
        <Argument name="s" type="diskit.Sensor">
            <Comment>This entities Sensor</Comment>
        </Argument>
        <StateTransition state="visualPerception">
            <Operation method="addSimEventListener(this)"/>
        </StateTransition>
        <Code/>
        <Coordinate x="150" y="110"/>
    </Event>
    <Event name="ReviewPatrol">
        <Comment>Listens to diskit.SceneZoneCreator to get Patrol Zone responsibilities</Comment>
        <Argument name="zones" type="diskit.ProbabilityZoneGeometry[]">
            <Comment>Zones for this simulation</Comment>
        </Argument>
        <StateTransition state="waypointGenerator">
            <Assignment value="new diskit.WaypointCreator(zones)"/>
        </StateTransition>
        <StateTransition state="patrolManager">
            <Assignment value="new diskit.ZoneMoverManager(this, waypointGenerator, avoidanceRange)"/>
        </StateTransition>
        <Schedule event="Patrol"/>
        <Code/>
        <Coordinate x="160" y="240"/>
    </Event>
    <Event name="Patrol">
        <Comment>Patrolling behavior for this entity. Speed is random and always less than the max speed</Comment>
        <LocalVariable name="rn" type="java.util.Random" value="new Random()">
            <Comment>Pseudorandom number generator for fluxuating speeds and times between patrol movements</Comment>
        </LocalVariable>
        <LocalVariable name="currentSpeed" type="double" value="getMaximumSpeed() * rn.nextDouble()">
            <Comment>creates a crusing speed between zero and the max speed of this craft</Comment>
        </LocalVariable>
        <LocalVariable name="waypoint" type="diskit.Vec3d" value="waypointGenerator.createWaypoint()">
            <Comment>Provides a waypoint within the geometry specified</Comment>
        </LocalVariable>
        <LocalVariable name="startPosition" type="diskit.Vec3d" value="waypointGenerator.createWaypoint()">
            <Comment>Pick a random start position</Comment>
        </LocalVariable>
        <StateTransition state="speed">
            <Assignment value="currentSpeed"/>
        </StateTransition>
        <StateTransition state="tacticalMode">
            <Assignment value="diskit.TacticalMode.PATROLLING"/>
        </StateTransition>
        <Code>setStartPosition(startPosition);
setDestination(waypoint);
setCruiseSpeed(currentSpeed);
//System.out.println("doPatrol Event:");
//System.out.println("Heading to: " + waypoint);</Code>
        <Coordinate x="160" y="360"/>
    </Event>
    <Event name="ScaleSpeedToKnots">
        <Comment>Scales max speed to knots</Comment>
        <LocalVariable name="newMaxSpeed" type="double" value="maximumSpeed/2">
            <Comment/>
        </LocalVariable>
        <Code>setMaximumSpeed(newMaxSpeed);</Code>
        <Coordinate x="30" y="320"/>
    </Event>
    <Code/>
</SimEntity>

