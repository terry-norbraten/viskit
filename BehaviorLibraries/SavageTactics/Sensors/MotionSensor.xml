<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<SimEntity author="Rick Goldberg" extend="diskit.SphereCutterSensor" name="MotionSensor" package="Sensors" version="1.0" xsi:noNamespaceSchemaLocation="http://diana.gl.nps.navy.mil/Simkit/simkit.xsd" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">
    <Comment>Sporadically creates false detections. Set mean time between failures in parameters.</Comment>
    <Parameter name="mover" type="diskit.Mover3D">
        <Comment/>
    </Parameter>
    <Parameter name="maxRange" type="double">
        <Comment/>
    </Parameter>
    <Parameter name="MTBF" type="double">
        <Comment>mean time between failures</Comment>
    </Parameter>
    <Parameter name="MTBFStandarDeviation" type="double">
        <Comment>standard deviation of failures</Comment>
    </Parameter>
    <StateVariable name="MTBFVariate" type="simkit.random.RandomVariate">
        <Comment>random variate for MTBF</Comment>
    </StateVariable>
    <StateVariable name="falsePositiveCount" type="int">
        <Comment>keeps a tally</Comment>
    </StateVariable>
    <StateVariable name="self" type="Sensors.MotionSensor">
        <Comment>reference to this</Comment>
    </StateVariable>
    <Event name="Run">
        <Comment/>
        <StateTransition state="MTBFVariate">
            <Assignment value="simkit.random.RandomVariateFactory.getInstance(&quot;NormalVariate&quot;,MTBF,MTBFStandarDeviation)"/>
        </StateTransition>
        <StateTransition state="falsePositiveCount">
            <Assignment value="0"/>
        </StateTransition>
        <StateTransition state="self">
            <Assignment value="this"/>
        </StateTransition>
        <StateTransition state="self">
            <Operation method="setMover((diskit.Mover3D)getSimEventListeners()[0])"/>
        </StateTransition>
        <Schedule condition="true" delay="java.lang.Math.max(0.0,MTBFVariate.generate())" event="FalsePositive" priority="0.0">
            <Comment/>
        </Schedule>
        <Code/>
        <Coordinate x="30" y="30"/>
    </Event>
    <Event name="Detection">
        <Comment/>
        <Argument name="sensor" type="diskit.Sensor"/>
        <Argument name="contact" type="diskit.Mover3D">
            <Comment>either the contact or a phantom</Comment>
        </Argument>
        <Code/>
        <Coordinate x="190" y="150"/>
    </Event>
    <Event name="FalsePositive">
        <Comment/>
        <StateTransition state="falsePositiveCount">
            <Assignment value="falsePositiveCount+1"/>
        </StateTransition>
        <Schedule condition="true" delay="0.0" event="Detection" priority="0.0">
            <Comment/>
            <EdgeParameter value="this"/>
            <EdgeParameter value="this.getMover()"/>
        </Schedule>
        <Schedule condition="true" delay="java.lang.Math.max(0.0,MTBFVariate.generate())" event="FalsePositive" priority="0.0">
            <Comment/>
        </Schedule>
        <Code/>
        <Coordinate x="30" y="150"/>
    </Event>
</SimEntity>
